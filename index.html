<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { color: #007bff; border-bottom: 3px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; font-size: 28px; }
        h2 { color: #34495e; margin-top: 25px; font-size: 22px; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background-color: #ecf0f1; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); }
        .card-title { font-weight: bold; color: #7f8c8d; margin-bottom: 5px; font-size: 14px; }
        .card-value { font-size: 24px; font-weight: 600; color: #2c3e50; }
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ©ãƒ¼ */
        .status-ok { color: #2ecc71; font-weight: bold; }
        .status-error { color: #e74c3c; font-weight: bold; }
        .status-pending { color: #f39c12; font-weight: bold; }
        /* æˆ¦ç•¥è¡¨ç¤º */
        .strategy { background-color: #e8f5e9; border: 1px solid #c8e6c9; padding: 15px; border-radius: 8px; font-size: 16px; font-weight: 500; color: #1b5e20; }
        /* ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆãƒªã‚¿ãƒ¼ãƒ³ */
        .backtest-negative { color: #e74c3c; }
        .backtest-positive { color: #2ecc71; }
    </style>
</head>
<body>
    <div class="container">
        <h1>â‚¿ BTCå®Ÿè·µãƒ†ã‚¯ãƒ‹ã‚«ãƒ«åˆ†æ BOT ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <p>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æã¨ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹æˆ¦ç•¥æ¤œè¨¼</p>

        <div class="card-grid">
            <div class="card">
                <div class="card-title">ğŸ’° ç¾åœ¨ä¾¡æ ¼ (BTC-USD)</div>
                <div class="card-value" id="current_price">N/A</div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ“… æœ€çµ‚æ›´æ–°</div>
                <div class="card-value" id="last_updated">N/A</div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ”„ BOTã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                <div class="card-value" id="scheduler_status">åˆæœŸåŒ–ä¸­</div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ¯ ç·åˆå„ªå‹¢åº¦</div>
                <div class="card-value" id="dominance">N/A</div>
            </div>
        </div>

        <h2>ğŸ›¡ï¸ æ¨å¥¨ã•ã‚Œã‚‹ç·åˆæˆ¦ç•¥</h2>
        <div class="strategy" id="strategy">ãƒ‡ãƒ¼ã‚¿å‡¦ç†ä¸­</div>

        <h2>ğŸ“ˆ ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆçµæœ (1å¹´ / 1dè¶³)</h2>
        <div class="card-grid">
             <div class="card">
                <div class="card-title">ç·ãƒªã‚¿ãƒ¼ãƒ³ç‡</div>
                <div class="card-value" id="total_return">N/A</div>
            </div>
            <div class="card">
                <div class="card-title">æœ€çµ‚è³‡æœ¬</div>
                <div class="card-value" id="final_capital">N/A</div>
            </div>
            <div class="card">
                <div class="card-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒƒãƒˆãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ (PF)</div>
                <div class="card-value" id="profit_factor">N/A</div>
            </div>
            <div class="card">
                <div class="card-title">æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ (DD)</div>
                <div class="card-value" id="max_drawdown">N/A</div>
            </div>
        </div>

        <p>å‡¦ç†ãƒ‡ãƒ¼ã‚¿ç¯„å›²: <span id="data_range">{{ data.data_range }}</span></p>

    </div>

    <script>
        const updateDashboard = async () => {
            try {
                // /status ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰æœ€æ–°ã®JSONãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const response = await fetch('/status');
                const data = await response.json();

                // 1. ãƒ¡ã‚¤ãƒ³æŒ‡æ¨™ã®æ›´æ–°
                const priceValue = data.current_price || 0;
                document.getElementById('current_price').textContent = priceValue ? `$${priceValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` : 'N/A';
                document.getElementById('last_updated').textContent = data.last_updated;
                document.getElementById('dominance').textContent = data.dominance; // å„ªå‹¢åº¦ã‚’åæ˜ 
                document.getElementById('strategy').textContent = data.strategy;
                
                // 2. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–° (è‰²ä»˜ã‘)
                const statusElement = document.getElementById('scheduler_status');
                statusElement.textContent = data.scheduler_status;
                statusElement.className = 'card-value';
                if (data.scheduler_status && data.scheduler_status.includes('ç¨¼åƒä¸­')) {
                    statusElement.classList.add('status-ok');
                } else if (data.scheduler_status && data.scheduler_status.includes('ã‚¨ãƒ©ãƒ¼')) {
                    statusElement.classList.add('status-error');
                } else {
                    statusElement.classList.add('status-pending');
                }

                // 3. ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆçµæœã®æ›´æ–°
                const backtest = data.backtest;
                if (backtest && backtest.final_capital) {
                    
                    const totalReturnElement = document.getElementById('total_return');
                    const totalReturnRate = backtest.total_return || 0;
                    totalReturnElement.textContent = `${totalReturnRate}%`;
                    totalReturnElement.className = 'card-value';
                    // ãƒªã‚¿ãƒ¼ãƒ³ç‡ã«å¿œã˜ã¦è‰²åˆ†ã‘
                    if (totalReturnRate < 0) {
                        totalReturnElement.classList.add('backtest-negative');
                    } else if (totalReturnRate > 0) {
                        totalReturnElement.classList.add('backtest-positive');
                    }
                    
                    const finalCapitalValue = backtest.final_capital || 0;
                    document.getElementById('final_capital').textContent = `$${finalCapitalValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                    document.getElementById('profit_factor').textContent = backtest.profit_factor || 'N/A';
                    document.getElementById('max_drawdown').textContent = `${backtest.max_drawdown || 0}%`;
                    
                } else {
                    document.getElementById('total_return').textContent = 'ãƒ‡ãƒ¼ã‚¿ä¸è¶³ / å®Ÿè¡Œå¾…ã¡';
                    document.getElementById('final_capital').textContent = 'N/A';
                    document.getElementById('profit_factor').textContent = 'N/A';
                    document.getElementById('max_drawdown').textContent = 'N/A';
                }

            } catch (error) {
                console.error('Error fetching status data:', error);
                document.getElementById('scheduler_status').textContent = 'é€šä¿¡ã‚¨ãƒ©ãƒ¼';
                document.getElementById('scheduler_status').classList.add('status-error');
            }
        };

        // åˆå›å®Ÿè¡Œ
        updateDashboard();
        // 5ç§’ã”ã¨ã«æ›´æ–°ã‚’ç¹°ã‚Šè¿”ã™
        setInterval(updateDashboard, 5000); 

    </script>
</body>
</html>
