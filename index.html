<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>{{ title }}</title>
    <style>
        /* ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒç¨¼åƒä¸­ã«ç‚¹æ»…ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .pulsing {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white p-8 rounded-xl shadow-2xl max-w-2xl w-full">
        <header class="text-center mb-8">
            <!-- ã‚°ãƒ©ãƒ•ã‚¢ã‚¤ã‚³ãƒ³ (Tailwind CSS/Lucide-reacté¢¨ SVG) -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-600 mx-auto mb-4" viewBox="0 0 20 20" fill="currentColor">
                <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" />
            </svg>
            <h1 class="text-3xl font-extrabold text-gray-900">{{ title }}</h1>
            <p id="scheduler-status" class="text-sm font-semibold mt-1 p-1 inline-block rounded-full bg-green-100 text-green-700">
                <span class="inline-block w-2 h-2 mr-1 bg-green-500 rounded-full {{ 'pulsing' if 'ç¨¼åƒä¸­' in data.scheduler_status else '' }}"></span>
                ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼: {{ data.scheduler_status }}
            </p>
        </header>

        <section class="space-y-4">
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                <h2 class="text-xl font-bold text-blue-800 mb-2 border-b border-blue-300 pb-1">ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>
                <dl class="text-gray-700">
                    <div class="flex justify-between py-1 border-b border-gray-100">
                        <dt class="font-medium">æœ€çµ‚æ›´æ–°æ—¥æ™‚:</dt>
                        <dd id="last-updated" class="font-bold text-gray-800">{{ data.last_updated }}</dd>
                    </div>
                    <div class="flex justify-between py-1 border-b border-gray-100">
                        <dt class="font-medium">å–å¾—ãƒ‡ãƒ¼ã‚¿æœŸé–“:</dt>
                        <dd id="data-range" class="font-semibold">{{ data.data_range }}</dd>
                    </div>
                    <div class="flex justify-between py-1">
                        <dt class="font-medium">å–å¾—ãƒ‡ãƒ¼ã‚¿ä»¶æ•°:</dt>
                        <dd id="data-count" class="font-semibold text-gray-800">{{ data.data_count }} ä»¶</dd>
                    </div>
                </dl>
            </div>
            
            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                <h2 class="text-xl font-bold text-yellow-800 mb-2 border-b border-yellow-300 pb-1">æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
                <p class="text-gray-700">
                    ç¾åœ¨ã€ãƒ‡ãƒ¼ã‚¿ã¯ãƒ€ãƒŸãƒ¼å€¤ã§ã™ã€‚`app.py`ã® `fetch_data` é–¢æ•°å†…ã«å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
                </p>
            </div>
        </section>
    </div>

    <script>
        // 10ç§’ã”ã¨ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        async function updateStatus() {
            try {
                // ğŸ’¥ ä¿®æ­£: ç›¸å¯¾URLã®ã‚¨ãƒ©ãƒ¼å›é¿ã®ãŸã‚ã€window.location.origin ã‚’ä½¿ç”¨
                const url = window.location.origin + '/status';
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§è¡¨ç¤ºã‚’æ›´æ–°
                document.getElementById('last-updated').textContent = data.last_updated;
                document.getElementById('data-range').textContent = data.data_range;
                document.getElementById('data-count').textContent = data.data_count + ' ä»¶';
                
                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ã€ç¨¼åƒä¸­ã¯ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹
                const isRunning = data.scheduler_status.includes('ç¨¼åƒä¸­');
                document.getElementById('scheduler-status').innerHTML = `
                    <span class="inline-block w-2 h-2 mr-1 bg-green-500 rounded-full ${isRunning ? 'pulsing' : ''}"></span>
                    ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼: ${data.scheduler_status}
                `;
                
            } catch (error) {
                console.error("ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
                document.getElementById('last-updated').textContent = 'ã‚¨ãƒ©ãƒ¼ (é€šä¿¡)';
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã¨10ç§’ã”ã¨ã«æ›´æ–°
        document.addEventListener('DOMContentLoaded', () => {
            // ãƒšãƒ¼ã‚¸è¡¨ç¤ºç›´å¾Œã«ä¸€åº¦å®Ÿè¡Œ
            updateStatus();
            // ä»¥é™ã€10ç§’ã”ã¨ã«å®Ÿè¡Œ
            setInterval(updateStatus, 10000); 
        });
    </script>
</body>
</html>
